From 04dd02515d1ee05e26629ba540afc53986ae60e0 Mon Sep 17 00:00:00 2001
From: Bastien Montagne <bastien@blender.org>
Date: Fri, 18 Feb 2022 11:05:34 +0100
Subject: [PATCH] Fix compilation on GCC11.

GCC11 removed some 'implicit includes', see
https://www.gnu.org/software/gcc/gcc-11/porting_to.html#header-dep-changes
for reference.
---
 pxr/base/js/testenv/testJsWriter.cpp | 1 +
 pxr/base/tf/testenv/weakPtr.cpp      | 1 +
 pxr/base/work/singularTask.h         | 2 +-
 pxr/usd/sdr/shaderMetadataHelpers.h  | 2 ++
 4 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/pxr/base/js/testenv/testJsWriter.cpp b/pxr/base/js/testenv/testJsWriter.cpp
index cd897b8f4c..bd2a1788a0 100644
--- a/pxr/base/js/testenv/testJsWriter.cpp
+++ b/pxr/base/js/testenv/testJsWriter.cpp
@@ -29,6 +29,7 @@
 #include "pxr/base/tf/diagnostic.h"
 
 #include <fstream>
+#include <limits>
 
 PXR_NAMESPACE_USING_DIRECTIVE
 
diff --git a/pxr/base/tf/testenv/weakPtr.cpp b/pxr/base/tf/testenv/weakPtr.cpp
index 6950d502d3..53e55d48b7 100644
--- a/pxr/base/tf/testenv/weakPtr.cpp
+++ b/pxr/base/tf/testenv/weakPtr.cpp
@@ -37,6 +37,7 @@
 #include <map>
 #include <mutex>
 #include <string>
+#include <thread>
 
 PXR_NAMESPACE_USING_DIRECTIVE
 
diff --git a/pxr/base/work/singularTask.h b/pxr/base/work/singularTask.h
index 0c7914d0b7..bc82bbf748 100644
--- a/pxr/base/work/singularTask.h
+++ b/pxr/base/work/singularTask.h
@@ -108,7 +108,7 @@ class WorkSingularTask
                     // case we go again to ensure the task can do whatever it
                     // was awakened to do.  Once we successfully take the count
                     // to zero, we stop.
-                    size_t old = count;
+                    std::size_t old = count;
                     do { _fn(); } while (
                         !count.compare_exchange_strong(old, 0));
                 });
diff --git a/pxr/usd/sdr/shaderMetadataHelpers.h b/pxr/usd/sdr/shaderMetadataHelpers.h
index 1402a27e71..0ed3274a94 100644
--- a/pxr/usd/sdr/shaderMetadataHelpers.h
+++ b/pxr/usd/sdr/shaderMetadataHelpers.h
@@ -32,6 +32,8 @@
 #include "pxr/base/tf/token.h"
 #include "pxr/usd/sdr/declare.h"
 
+#include <limits>
+
 PXR_NAMESPACE_OPEN_SCOPE
 
 /// \namespace ShaderMetadataHelpers
